{% extends "admin/admin_base.html" %}

{% block title %}
{{ article.title }}
{% endblock title %}

{% block css %}
<script src='/js/highlight.pack.js'></script>
<script src="/js/arttemplate.js"></script>
<link href='/css/monokai_default.css' rel='stylesheet'/>
<link href='/css/article_view.css' rel='stylesheet'/>
<style>
    pre {
        padding: 0px;
    }
</style>
{% endblock css %}

{% block body %}
<header>
    <div class="img">
        <img src="/images/img_12.webp" class="img-fluid rounded"/><br>
        <p class="text-end">--- 摄于 2017 年 9 月 藏川线前段</p>
    </div>
</header>
<div class="container">
  <div class="row justify-content-center">
    <div id="article-content" class="col-lg-10 col-md-11 col-12" data-id={{ article.id }}>
      {{ article.content | safe }}
    </div>
  </div>
</div>

{% endblock body %}

{% block script %}
<script>
    "use strict";
    $(function () {
        var id = $("#article-content").attr("data-id");
        hightlight($("pre code"));
        $.getJSON("/api/v1/article/admin/view?id=" + id, function (result) {
            $("#article-content")
                .append("<blockquote class='float-end'><h5 class='post-meta'>Last Modified:</h5>" +
                    "<p class='float-end post-meta'>" + moment.utc(result.data.modify_time).local().format("YYYY-MM-DD HH:mm:ss") +
                    "</p></blockquote>");
            var tags = {data: []};

            $.each(result.data.tags, function (index, value) {
                if (value !== null) {
                    tags.data.push([result.data.tags_id[index], value])
                }
            });
            var html = template("tpl-tag-list", tags);
            $("#article-content").children().first().after(html)
        });
    });

    function hightlight($doms) {
        $doms.each(function(i, block) {
            hljs.highlightBlock(block);
        });
    }
</script>
<script id="tpl-tag-list" type="text/html">
    {% raw %}
    <div style="margin-bottom: 10px;">
        {{each data}}
        <span class='badge bg-info text-dark' tag-id={{ $value[0] }}><i class='bi bi-tags' style='margin-right: 5px;'></i>{{ $value[1] }}</span>
        {{/each}}
    </div>
    {% endraw %}
</script>
{% endblock script%}
